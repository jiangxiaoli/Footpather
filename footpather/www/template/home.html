<!--add scroll="false" data-tap-disabled="true" to enable on-click-->
<ion-view title="Home" scroll="false" data-tap-disabled="true">



  <map center="current-location" zoom="16" id="map" pan-control="false" zoom-control="false" scale-control="false" styles="{{styles}}" on-drag-end="refreshMap()">

    <!--buttons-->
    <button id="find-me-btn" ng-click="centerOnMe()" class="button icon ion-pinpoint"></button>
    <button id="help-me-btn" ng-click="showHelpPopup()" class="button icon-left ion-alert button-assertive">HELP ME!</button>
    <button id="report-btn" ng-click="showReportMenuPopup()" class="button icon-left ion-speakerphone button-stable">Report</button>
    <button id="navigate-btn" ng-click="navModal.show()" ng-show="!inNavigate" class="button icon-left ion-map button-stable">Navigate</button>
    <button id="stop-navigate-btn" ng-click="clearRoute()" ng-show="inNavigate" class="button button-stable">Stop Navigate</button>
    <!--<button id="refresh-map-btn" ng-click="refreshMap()" class="button button-stable">Refresh</button>-->

    <!--current locaiton marker-->
    <marker position="current-location"></marker>

    <!--crime markers-->
    <marker ng-repeat="crime in crimereports.crimes" on-click="showCrimePopup(crime)" position="[{{crime.lat}}, {{crime.lng}}]" icon="/img/icons/crime.png">
    </marker>
    <script id="templates/crimePopup.html" type="text/ng-template">
      <div class="text-center">
        <img ng-src="{{streetViewUrl}}" height="100px">
        <h5>Time: {{currCrime.incident_date_time | date:'MM/dd/yyyy @ h:mma'}}</h5>
      </div>
      <!--overlay center icon-->
      <img class="top-center-icon" ng-src="/img/icons/crime.png"/>
    </script>

    <!--sex offender markers-->
    <marker ng-repeat="offender in crimereports.offenders" on-click="showOffenderPopup(offender)" position="[{{offender.lat}}, {{offender.lng}}]" icon="/img/icons/offender.png">
    </marker>
    <script id="templates/offenderPopup.html" type="text/ng-template">
      <div class="text-center">
        <img ng-src="{{currOffender.photoUrl}}" alt="offender photo" height="120px"/>
        <h4>{{currOffender.name}}</h4>
      </div>
      <div class="row">
        <div class="col col-33 text-right">Address:</div>
        <div class="col">{{currOffender.address}}</div>
      </div>
    </script>

    <!--report markers-->
    <marker ng-repeat="report in reports" on-click="showReportPopup(report)" position="[{{report.latitude}}, {{report.longitude}}]" icon="/img/icons/report.png">
    </marker>
    <script id="templates/reportPopup.html" type="text/ng-template">
      <div class="text-center">
        <div class="row">
          <div class="col col-50">
            <!--mapping type to icon name-->
            <img ng-src="/img/icons/report.png" alt="" height="80px"/>
            <h4>{{currReport.type}} </h4>
            <h5>{{currReport.description}}</h5>
          </div>
          <div class="col">
            <h4>Time: {{currReport.date | date:'MM/dd/yyyy @ h:mma'}}</h4>
            <h4>Likes: {{currReport.likes}}</h4>
            <button class="button button-outline button-assertive" ng-click="likeReport(currReport)">Like</button>
          </div>
        </div>
      </div>
      <!--overlay center icon-->
      <img class="top-center-icon" ng-src="/img/icons/report.png"/>
    </script>

    <!--Place markers-->
    <marker ng-repeat="place in places" on-click="showPlacePopup(place)" ng-show="place.opening_hours.open_now" position="[{{place.geometry.location.lat}}, {{place.geometry.location.lng}}]" icon="/img/icons/place.png">
    </marker>
    <script id="templates/placePopup.html" type="text/ng-template">
      <div class="text-center">
        <h4>{{currPlace.name}}</h4>
        <h6>{{currPlace.vicinity}}</h6>
      </div>
    </script>

    <!--user markers-->
    <marker ng-repeat="user in users" position="[{{user.latitude}}, {{user.longitude}}]" icon="/img/icons/girl.png">
    </marker>

    <!--route - directions-->
    <directions ng-show="inNavigate"
      panel="directions-panel"
      travel-mode="WALKING"
      origin="{{origin}}"
      destination="{{destination}}">
    </directions>

  </map>

  <!--navigate input modal-->
  <script id="templates/navigateModal.html" type="text/ng-template">
    <ion-modal-view id="navigateModal">
      <ion-header-bar class="bar bar-header bar-stable">
        <h1 class="title">Plan a Footpath</h1>
        <button class="button button-clear button-primary" ng-click="navModal.hide()">Cancel</button>
      </ion-header-bar>
      <ion-content class="padding">

        <div class="list">
          <label class="item item-input">
            <span class="input-label">From</span>
            <ion-autocomplete ng-model="navigate.from"
                              item-view-value-key="view"
                              item-value-key="location"
                              items-method="getTestItems(query)"
                              placeholder="Enter your start location..."
                              items-clicked-method="fromLocSelect(callback)"></ion-autocomplete>
          </label>
          <label class="item item-input">
            <span class="input-label">To</span>
            <ion-autocomplete ng-model="navigate.to"
                              item-view-value-key="view"
                              item-value-key="location"
                              items-method="getTestItems(query)"
                              placeholder="Enter your end location..."
                              items-clicked-method="toLocSelect(callback)"></ion-autocomplete>
          </label>
          <button class="button button-full button-positive" ng-click="calculateNavigation(navigate)">Start Navigate</button>
        </div>
      </ion-content>
    </ion-modal-view>
  </script>


  <script id="templates/reportMenuPopup.html" type="text/ng-template">
    <div class="">
      <!-- Passing 4 types: suspecious, location, animal, others -->
      <img ng-src="/img/icons/girl.png" height="120px" ng-click="showEditReportPopup('girl')"/>
      <img ng-src="/img/icons/crime.png" height="120px" ng-click="showEditReportPopup('crime')"/>
      <img ng-src="/img/icons/offender.png" height="120px" ng-click="showEditReportPopup('offender')"/>
    </div>
  </script>

  <script id="templates/reportEditPopup.html" type="text/ng-template">
    <div class="">
      <!--mapping type to icon name-->
      <img ng-src="/img/icons/{{newReport.type}}.png" alt="" height="80px"/>
      <input type="text" ng-model="newReport.description" placeholder="Description..."/>
    </div>
  </script>

  <script id="templates/helpPopup.html" type="text/ng-template">
    <div class="text-center">
      <h1 class="assertive">Help Me!</h1>
      <button class="button button-block button-assertive">Call 911</button>
      <button class="button button-block button-energized">Alert Nearby Users</button>
    </div>
  </script>

</ion-view>
